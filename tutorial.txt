本教程将指导你从零开始部署 OpenVPN 服务器，让你能够搭建自己的 VPN 服务。

通过本教程，你将学会：
- 如何选择和配置合适的云服务器
- OpenVPN 服务器的完整安装流程
- 客户端配置和连接方法

## 第一步：准备云服务器

### 选择云服务商
本教程以 DigitalOcean 为例进行演示。你也可以选择其他云服务商，如 AWS、阿里云、腾讯云等。

### 服务器配置要求

**操作系统建议**
- 推荐使用：**Ubuntu 22.04 LTS x64**
- 原因：稳定性和兼容性较高
- 其他选择：如果你熟悉 Debian、CentOS 等系统，也可以根据实际情况调整安装步骤

**推荐配置（DigitalOcean 最低档）：**
- 价格：$4/月（$0.006/小时）
- 内存：512 MB
- CPU：1 核心
- 存储：10 GB SSD
- 流量：500 GB/月

> **性能提示**：如果你发现通过 VPN 隧道传输数据的速度较慢，建议选择 CPU 优化型的虚拟机（Droplet），因为数据的加密和解密是非常依赖 CPU 性能的操作。

### 🔒 重要：检查服务器端口设置

在开始安装 OpenVPN 之前，你需要确保服务器的这几个端口是开放的：

| 端口号 | 协议 | 用途说明 |
|--------|------|----------|
| 22 | SSH | 用于远程登录和管理服务器 |
| 80 | HTTP | 用于网页访问（OpenVPN 配置下载） |
| 443 | HTTPS | 用于安全的网页访问 |
| 1194 | UDP | OpenVPN 默认端口（数据传输） |

**如何检查端口是否开放？**

1. **检查防火墙状态：**
   ```bash
   sudo ufw status
   ```

2. **检查端口是否被监听：**
   ```bash
   # 使用 ss 命令（推荐，现代系统默认安装）
   sudo ss -tulpn | grep -E ':(22|80|443|1194)\s'
   
   # 或者安装并使用 netstat（如果系统没有预装）
   sudo apt update && sudo apt install net-tools
   sudo netstat -tulpn | grep -E ':(22|80|443|1194)\s'
   ```

3. **如果端口未开放，使用以下命令开放端口：**
   ```bash
   # 开放 SSH 端口（通常默认已开放）
   sudo ufw allow 22/tcp
   
   # 开放 HTTP 端口
   sudo ufw allow 80/tcp
   
   # 开放 HTTPS 端口
   sudo ufw allow 443/tcp
   
   # 开放 OpenVPN 端口
   sudo ufw allow 1194/udp
   
   # 启用防火墙
   sudo ufw enable
   ```

> **💡 DigitalOcean 用户提示**：DigitalOcean 默认是"全开放"端口策略，除非你自己在 Cloud Firewall 添加规则，所以如果跟着我使用 DigitalOcean 就不必担心这类问题。

> **💡 新手提示**：这些命令适用于 Ubuntu/Debian 系统。如果你使用其他系统，可能需要使用不同的防火墙管理工具（如 CentOS 的 firewalld）。

## 第二步：配置 OpenVPN 服务器

### 准备工作

1. 获取服务器 IP 地址
   - 进入你的 VPS 控制面板
   - 复制服务器的 IPv4 地址(xxx.xxx.xxx.xxx)并保存起来

2. 安装 OpenVPN 和相关组件

i. **更新系统包列表：**
   ```bash
   sudo apt update
   ```

ii. **安装 OpenVPN 和 Easy-RSA：**
   ```bash
   sudo apt install openvpn easy-rsa
   ```

iii. **处理安装过程中的提示：**
   
   如果出现磁盘空间使用确认提示：
   ```
   After this operation, 6865 kB of additional disk space will be used.
   Do you want to continue? [Y/n]
   ```
   **请输入 `Y` 并按回车键继续安装**

   如果出现紫色配置界面（通常是服务配置选项）：
   **请选择第一个选项（默认选项）并按回车键确认**


3. 配置 OpenVPN 服务 

OpenVPN 的主要配置文件位于 `/etc/openvpn/server.conf`

**检查当前所在目录：**
   ```bash
   pwd
   ```
   
   如果显示结果是 `/root`，说明你当前在 root 用户的目录：
   ```
   root@ubuntu-s-1vcpu-512mb-10gb-sfo3-01:~# pwd
   /root
   ```

**切换到根目录：**
   ```bash
   cd /
   ```
   
   再次确认位置：
   ```bash
   pwd
   ```
   
   现在应该显示：
   ```
   root@ubuntu-s-1vcpu-512mb-10gb-sfo3-01:/# pwd
   /
   ```
 **验证目录结构（可选）：**
   ```bash
   ls
   ```
   
   你应该能看到 `etc` 文件夹以及其他系统目录。

目录说明 :`/` 是 Linux 系统的根目录，`/etc` 是存放系统配置文件的目录，OpenVPN 的配置文件就在 `/etc/openvpn/` 路径下。

编辑 `/etc/openvpn/server.conf` 配置文件，主要修改以下几项：

- **port**: 设置 OpenVPN 使用的端口，默认是 `1194`。
- **proto**: 设置协议，通常是 `udp`。
- **dev**: 设置虚拟设备，通常使用 `tun`。
- **server**: 配置 VPN 网络的 IP 地址范围。
- **ca**、**cert**、**key**: 设置证书和密钥文件。
















3. 启动 OpenVPN 服务

开启openvpn
sudo systemctl start openvpn@server

如果想要让openvpn自启动请输入
sudo systemctl enable openvpn@server

4. 检查 OpenVPN 服务状态

你可以通过以下命令检查 OpenVPN 服务是否正在运行：

`sudo systemctl status openvpn@server`

如果正常运行会出现